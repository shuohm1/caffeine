<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Caffeine</title>
  </head>
  <body>
    <video id="klHxKeNt" width="640" height="360" autoplay controls loop muted playsinline>
      <p>video unavailable</p>
    </video>
    <script type="text/javascript" src="thirdparty/zlib.js/bin/unzip.min.js"></script>
    <script type="text/javascript"><!--
function $(tag) {
  return document.getElementById(tag);
}

// get a video data from a zip-compressed and base64-encoded text file
const xhr = new XMLHttpRequest();
const pt = 't=' + (Date.now() / 1000).toFixed(3);
const requrl = 'video.txt'.concat('?', pt);
xhr.open('GET', requrl, true);
xhr.onload = function(e) {
  if (this.status === 0) {
    console.log(this);
    return;
  }

  // base64 to byte
  const b64text = this.responseText.replace(/\r?\n/g, '');
  const bytes = window.atob(b64text);

  // byte to uint8
  const n = bytes.length;
  const buffer = new Uint8Array(n);
  for (let i = 0; i < n; i++) {
    buffer[i] = bytes.charCodeAt(i);
  }

  // unzip
  const unzipper = new Zlib.Unzip(buffer);
  const filenames = unzipper.getFilenames();
  const plain = unzipper.decompress(filenames[0]);

  // generate a blob URL
  const blob = new Blob([plain], {type: 'video/mp4'});
  const burl = URL.createObjectURL(blob);
  $('klHxKeNt').setAttribute('src', burl);
};
xhr.send(null);

// play the video by clicking anywhere
document.addEventListener('click', function(){
  $('klHxKeNt').play();
});
/*
// auto replay
setInterval(function(){
  $('klHxKeNt').play();
}, 30000); // msec
*/
    // --></script>
  </body>
</html>
